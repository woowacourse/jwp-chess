<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <link href="/css/start.css" rel="stylesheet" type="text/css"/>
    <title>Play Chess!</title>
    <link rel="icon" href="/images/favicon.ico">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<h1>Play Chess!</h1>
<div class="container">
    <button onclick="playNewGame()">ìƒˆ ê²Œì„ ì‹œì‘í•˜ê¸°</button>
    <div>
        <div class="gameList">ì™„ë£Œë˜ì§€ ì•Šì€ ê²Œì„ ëª©ë¡ ğŸ‘‡ğŸ»</div>
        <div id="historyList">
            {{#history}}
                <div id="history">
                    <a class="{{name}}" href="/chess/game/{{name}}">{{name}}</a>
                </div>
            {{/history}}
        </div>
    </div>
</div>
</body>
<script>
    const playNewGame = () => {
        const name = prompt("ê²Œì„ ì €ì¥ ì‹œ ì´ìš©í•  ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        if (name !== null) {
            makeRoom(name);
        } else {
            window.location = `/chess/game/temporary`;
        }
    }

    const gameHistory = document.getElementById("historyList");
    if ($("#history").length === 0)
        gameHistory.innerText = "ë¹„ì–´ìˆìŠµë‹ˆë‹¤ - í……!";

    const makeRoom = (name) => {
        $.ajax({
        type: "POST",
        url: '/chess/game/'+name,
        async : false,
        headers: {
            "Accept": "application/json",
            "Content-Type": "application/json"
        },
        data: JSON.stringify({
        }),
        success: loadGame,
        error: showFoamRoomError,
        })
    }

    const loadGame = (response) => {
        const name = response.name;
        window.location = "/chess/game/"+name;
    }

    const showFoamRoomError = (response) => {
        alert(response.responseJSON.errorMessage);
    }

</script>
</html>